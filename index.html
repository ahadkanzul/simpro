<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ahad Sim Information | Matrix Lookup (Old ‚Üí New)</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
  *{box-sizing:border-box;margin:0;padding:0;font-family:'Share Tech Mono',monospace}
  body{background:radial-gradient(circle at center,#000 60%,#020202 100%);color:#00ff9d;min-height:100vh;overflow-x:hidden}
  .matrix-bg{position:fixed;inset:0;z-index:0;background:repeating-linear-gradient(0deg,rgba(0,255,0,0.04) 0 2px,transparent 3px,transparent 5px);animation:matrixAnim 10s linear infinite}
  @keyframes matrixAnim{0%{background-position-y:0}100%{background-position-y:1000px}}
  .container{position:relative;z-index:1;max-width:980px;margin:56px auto;padding:28px;border-radius:12px;background:rgba(0,0,0,0.86);border:2px solid #00ff9d;box-shadow:0 0 30px rgba(0,255,100,0.38)}
  header{text-align:center;margin-bottom:22px}
  header h1{color:#00ff9d;text-shadow:0 0 12px #00ff9d;font-size:2.1rem;letter-spacing:2px}
  header p{color:#7fffbd;font-size:1rem}
  .controls{display:flex;gap:12px;align-items:center;justify-content:center;margin-bottom:16px;flex-wrap:wrap}
  input[type="text"]{width:62%;min-width:220px;padding:12px;border-radius:6px;border:1px solid #00ff9d;background:transparent;color:#00ff9d;text-align:center;outline:none}
  input[type="text"]:focus{box-shadow:0 0 16px rgba(0,255,150,0.12)}
  button{padding:12px 18px;border-radius:6px;border:none;background:#00ff9d;color:#002;cursor:pointer;font-weight:700}
  button:hover{box-shadow:0 0 22px rgba(0,255,150,0.18)}
  .loading{display:none;text-align:center;margin:18px 0}
  .spinner{width:44px;height:44px;border-radius:50%;border:4px solid rgba(0,255,150,0.18);border-top-color:#00ff9d;animation:spin 1s linear infinite;margin:8px auto}
  @keyframes spin{to{transform:rotate(360deg)}}
  .result-section{display:none;margin-top:18px}
  .meta-note{color:#99f5c8;font-size:0.9rem;text-align:center;margin-bottom:10px}
  .result-card{background:linear-gradient(180deg,rgba(0,20,0,0.7),rgba(0,12,0,0.6));border:1px solid #00ff9d;border-radius:8px;padding:14px;margin-bottom:14px;box-shadow:0 0 14px rgba(0,255,0,0.12)}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .person-name{font-size:1.14rem;color:#a8ffd0}
  .sim-number{font-weight:700;color:#00ff9d}
  .small{font-size:0.92rem;color:#bfffd6}
  .label{color:#8fe9b6;font-size:0.82rem;min-width:86px}
  .field{color:#cffff0;font-weight:600}
  .no-data{padding:24px;text-align:center;color:#88ffbd;font-style:italic}
  footer{text-align:center;margin-top:26px;color:#07764a;font-size:0.9rem}
  @media (max-width:720px){input[type="text"]{width:100%} .controls{flex-direction:column}}
</style>
</head>
<body>
  <div class="matrix-bg" aria-hidden="true"></div>
  <div class="container">
    <header>
      <h1>AHAD SIM INFORMATION</h1>
      <p>Secure Lookup ‚Äî results ordered <strong>old ‚Üí new</strong></p>
    </header>

    <div class="controls" role="region" aria-label="search controls">
      <input id="searchInput" type="text" maxlength="20" placeholder="Enter SIM (e.g. 03338570120) or CNIC (e.g. 3240214025071)">
      <button id="lookupBtn">üîç Search</button>
      <button id="clearBtn" title="Clear results">‚úñ Clear</button>
    </div>

    <div class="loading" id="loadingIndicator">
      <div class="spinner" aria-hidden="true"></div>
      <div class="small">Accessing secure database...</div>
    </div>

    <div class="result-section" id="resultSection" aria-live="polite"></div>

    <div class="meta-note">Tip: displayed dates are taken from any `date/created_at/timestamp/added/updated` fields returned by the API.</div>

    <div class="credit" style="text-align:center;color:#00ff9d;margin-top:6px;font-size:0.9rem">Powered by Ahad | Matrix Interface</div>
  </div>

  <footer>¬© 2025 Ahad Sim Info</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const apiUrl = 'https://fam-official.serv00.net/api/famofc_simdatabase.php';
  const searchInput = document.getElementById('searchInput');
  const lookupBtn = document.getElementById('lookupBtn');
  const clearBtn = document.getElementById('clearBtn');
  const loadingIndicator = document.getElementById('loadingIndicator');
  const resultSection = document.getElementById('resultSection');

  lookupBtn.addEventListener('click', lookupInfo);
  clearBtn.addEventListener('click', clearResults);
  searchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') lookupInfo(); });

  function showLoading(on = true) {
    loadingIndicator.style.display = on ? 'block' : 'none';
  }

  function clearResults() {
    resultSection.innerHTML = '';
    resultSection.style.display = 'none';
    searchInput.value = '';
  }

  // Attempt to find and parse a date from an object (try several common keys)
  function extractDateFromObj(obj){
    if (!obj || typeof obj !== 'object') return null;
    const keys = ['date','created_at','timestamp','reg_date','added','updated','created','createdAt','updatedAt','time'];
    for (const k of keys){
      if (k in obj && obj[k]) {
        const raw = String(obj[k]).trim();
        const parsed = tryParseDate(raw);
        if (parsed) return parsed;
      }
    }
    // Also check nested fields (very shallow)
    for (const k of Object.keys(obj)) {
      if (typeof obj[k] === 'object' && obj[k] !== null) {
        const nested = extractDateFromObj(obj[k]);
        if (nested) return nested;
      }
    }
    return null;
  }

  // Try parse multiple formats; return timestamp (ms) or null
  function tryParseDate(text) {
    if (!text) return null;
    // If purely numeric and length looks like epoch seconds/milliseconds
    if (/^\d{10}$/.test(text)) { return Number(text) * 1000; }        // seconds
    if (/^\d{13}$/.test(text)) { return Number(text); }               // milliseconds
    // Replace common separators and attempt Date.parse
    const normalized = text.replace(/[:]/g, ':').replace(/[T]/g, ' ').replace(/\s+/g,' ').trim();
    const d = new Date(normalized);
    if (!isNaN(d.getTime())) return d.getTime();
    // Try dd-mm-yyyy or dd/mm/yyyy
    const dm = normalized.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/);
    if (dm) {
      const [ , dd, mm, yyyy ] = dm.map(Number);
      const dt = new Date(yyyy, mm - 1, dd);
      if (!isNaN(dt.getTime())) return dt.getTime();
    }
    // Try yyyy-mm-dd with optional time (already partly handled)
    return null;
  }

  function formatDate(ts) {
    if (!ts) return 'No date';
    const d = new Date(Number(ts));
    if (isNaN(d.getTime())) return 'No date';
    // Format: YYYY-MM-DD HH:MM (local)
    const YYYY = d.getFullYear();
    const MM = String(d.getMonth()+1).padStart(2,'0');
    const DD = String(d.getDate()).padStart(2,'0');
    const hh = String(d.getHours()).padStart(2,'0');
    const mm = String(d.getMinutes()).padStart(2,'0');
    return `${YYYY}-${MM}-${DD} ${hh}:${mm}`;
  }

  function lookupInfo() {
    const value = searchInput.value.trim();
    if (!value) { alert('Enter SIM or CNIC number'); return; }

    resultSection.innerHTML = '';
    resultSection.style.display = 'none';
    showLoading(true);

    fetch(`${apiUrl}?number=${encodeURIComponent(value)}`)
      .then(res => {
        if (!res.ok) throw new Error('Network response not ok');
        return res.json();
      })
      .then(data => {
        displayResultsSorted(data, value);
      })
      .catch(err => {
        console.error(err);
        resultSection.innerHTML = `<div class="result-card"><div class="small">‚ö†Ô∏è Failed to fetch data. Please try again later.</div></div>`;
        resultSection.style.display = 'block';
      })
      .finally(() => showLoading(false));
  }

  // Sort results from oldest ‚Üí newest and render
  function displayResultsSorted(apiResponse, queryValue) {
    resultSection.innerHTML = '';
    resultSection.style.display = 'block';

    if (!apiResponse || !apiResponse.success) {
      resultSection.innerHTML = `<div class="no-data">No information found for <strong>${escapeHtml(queryValue)}</strong>.</div>`;
      return;
    }

    let list = Array.isArray(apiResponse.data) ? apiResponse.data.slice() : [];
    if (list.length === 0) {
      // maybe the API returns a single object under data
      if (apiResponse.data && typeof apiResponse.data === 'object') list = [apiResponse.data];
    }

    if (!list || list.length === 0) {
      resultSection.innerHTML = `<div class="no-data">No information records returned.</div>`;
      return;
    }

    // For each item, compute a sortable timestamp. If no date found, assign Infinity so it sorts to the end (treated as newest).
    const enriched = list.map(item => {
      const ts = extractDateFromObj(item);
      return { item, ts: ts === null ? Infinity : ts };
    });

    // Sort ascending: old ‚Üí new (small ts first)
    enriched.sort((a,b) => a.ts - b.ts);

    // Render
    enriched.forEach(entry => {
      const sim = entry.item || {};
      const ts = isFinite(entry.ts) ? entry.ts : null;
      const dateText = ts ? formatDate(ts) : 'No date';

      const card = document.createElement('div');
      card.className = 'result-card';
      card.innerHTML = `
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="person-name">üë§ ${escapeHtml(sim.name || sim.owner || 'N/A')}</div>
            <div class="small">${escapeHtml(sim.address || sim.city || '')}</div>
          </div>
          <div style="text-align:right;">
            <div class="sim-number">üì± ${escapeHtml(sim.number || sim.sim || queryValue)}</div>
            <div class="small">${escapeHtml(sim.network || sim.operator || 'Unknown')}</div>
          </div>
        </div>
        <hr style="border:none;border-top:1px solid rgba(0,255,150,0.06);margin:10px 0">
        <div style="display:flex;gap:12px;flex-wrap:wrap;">
          <div><span class="label">CNIC:</span> <span class="field">${escapeHtml(sim.cnic || sim.national_id || 'N/A')}</span></div>
          <div><span class="label">Date:</span> <span class="field">${escapeHtml(dateText)}</span></div>
          <div><span class="label">Status:</span> <span class="field">${escapeHtml(sim.status || sim.state || 'N/A')}</span></div>
        </div>
      `;
      resultSection.appendChild(card);
    });
  }

  // basic escape
  function escapeHtml(s) {
    if (s === null || s === undefined) return '';
    return String(s).replace(/[&<>"'`=\/]/g, function (c) {
      return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'}[c];
    });
  }
});
</script>
</body>
</html>
